pipeline {
    agent any

    environment {
        JAVA_HOME = '/opt/jdk-21' // Chemin vers JDK 21
    }

    stages {

        stage('Récupération du code de la branche') {
            steps {
                git branch: 'master', url: 'https://github.com/AchrafBouslama/SopraHRProject.git'
            }
        } 

        stage('Build') {
            steps {
                dir('backoffice') {
                    script {
                        // Configuration du JDK pour ce répertoire
                        def jdkTool = tool name: 'jdk-21', type: 'jdk'
                        sh "${jdkTool}/bin/java -version" // Vérifie la version de Java utilisée

                        // Exécute le build Maven avec Java 21
                        sh "${jdkTool}/bin/java -version"
                        sh "${jdkTool}/bin/mvn clean package"
                    }
                }
            }
        }

        stage('Test') {
            steps {
                dir('backoffice') {
                    script {
                        // Configuration du JDK pour ce répertoire
                        def jdkTool = tool name: 'jdk-21', type: 'jdk'
                        sh "${jdkTool}/bin/java -version" // Vérifie la version de Java utilisée

                        // Exécute les tests Maven avec Java 21
                        sh "${jdkTool}/bin/java -version"
                        sh "${jdkTool}/bin/mvn test"
                    }
                }
            }
        }
    }
}
